<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>캐릭터 보스 계산기</title>
<style>
  body { font-family: sans-serif; margin:0; display:flex; height:100vh; }
  .panel { padding:10px; overflow-y:auto; }
  .left { width:25%; border-right:1px solid #ccc; }
  .center { width:50%; border-right:1px solid #ccc; }
  .right { width:25%; }

  /* 캐릭터 리스트 */
  .char-item { padding:5px; margin-bottom:1px; border:1px solid #aaa; cursor:grab; }
  .char-item.selected { background:#d0f0ff; }

  /* 첫 번째 줄 */
  .char-first-line { display:flex; align-items:center; justify-content:space-between; }
  .char-name {
    font-weight: bold;
    width: 103px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
  .char-sum { min-width:100px; margin-left:20px; text-align:right; flex-shrink:0; }
  .char-delete { cursor:pointer; color:red; margin-left:10px; flex-shrink:0; }

  /* 두 번째 줄 */
  .char-second-line { display:flex; gap:5px; margin-top:5px; }
  .char-second-line input { width:60px; }

  /* 보스 리스트 */
.boss-item {
  display: grid;
  grid-template-columns: 120px repeat(5, 80px);
  align-items: center;
  margin-bottom: 5px;
}

.boss-difficulty span {
  display: inline-block; 
  width: 65px;
  text-align: center;
  cursor:pointer; padding:2px 5px; border-radius:3px; color:white; font-size:0.85em;
}

.boss-difficulty span.EASY { background:#828282; box-shadow: inset 0 0 0 0.5px #646464; }
.boss-difficulty span.NORMAL { background:#37c3c3; box-shadow: inset 0 0 0 0.5px #37b7b7; }
.boss-difficulty span.HARD { background:#ff69b4; box-shadow: inset 0 0 0 0.5px #ff32b1; }
.boss-difficulty span.CHAOS { background:#3c3c3c; color:yellow; box-shadow: inset 0 0 0 0.5px yellow; }
.boss-difficulty span.EXTREME { background:black; color:red; box-shadow: inset 0 0 0 0.5px red; }

.boss-difficulty span.selected { font-weight:bold; border:none; box-shadow: inset 0 0 0 3px gold; }

#noteArea { width:90%; height:45%; resize:none; font-size:14px; padding:10px; box-sizing:border-box; }
</style>
</head>
<body>

<div class="panel left">
  <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
    <input id="charNameInput" placeholder="캐릭터 이름 입력">
    <div id="totalSum" style="font-weight:bold; white-space:nowrap;">합계: 0 억</div>
  </div>
  <div id="charList"></div>
</div>

<div class="panel center">
  <div id="bossList">캐릭터를 선택해주세요</div>
</div>

<div class="panel right">
  <textarea id="noteArea" placeholder="메모를 입력하세요"></textarea>
</div>

<script>
const STORAGE_KEY = "bossCalcData";

// 예시 보스 데이터
const bossData = [
  { name:"시그너스", difficulties:["EASY","NORMAL"], basePrice:{EASY:0.0455,NORMAL:0.075} },
  { name:"힐라", difficulties:["HARD"], basePrice:{HARD:0.0575} },
  { name:"핑크빈", difficulties:["CHAOS"], basePrice:{CHAOS:0.0658} },
  { name:"자쿰", difficulties:["CHAOS"], basePrice:{CHAOS:0.0808} },
  { name:"블러디퀸", difficulties:["CHAOS"], basePrice:{CHAOS:0.0814} },
  { name:"반반", difficulties:["CHAOS"], basePrice:{CHAOS:0.0815} },
  { name:"피에르", difficulties:["CHAOS"], basePrice:{CHAOS:0.0817} },
  { name:"매그너스", difficulties:["HARD"], basePrice:{HARD:0.0856} },
  { name:"벨룸", difficulties:["CHAOS"], basePrice:{CHAOS:0.0928} },
  { name:"파풀라투스", difficulties:["CHAOS"], basePrice:{CHAOS:0.138} },
];

let selectedCharacters = JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]");

const charList = document.getElementById('charList');
const bossList = document.getElementById('bossList');
const totalSum = document.getElementById('totalSum');
const noteArea = document.getElementById('noteArea');

noteArea.value = localStorage.getItem("bossCalcNote")||"";
noteArea.addEventListener("input", ()=>{ localStorage.setItem("bossCalcNote", noteArea.value); });

document.getElementById('charNameInput').addEventListener('keydown',(e)=>{
  if(e.key==='Enter' && e.target.value.trim()!==''){
    const charName = e.target.value.trim();
    const char = { name:charName, level:'', job:'', notes:['','',''], selected:false, bosses:[] };
    selectedCharacters.push(char);
    e.target.value='';
    saveData();
    renderCharList();
  }
});

function saveData(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(selectedCharacters));
}

function renderCharList(){
  charList.innerHTML='';
  selectedCharacters.forEach((char,index)=>{
    const div=document.createElement('div');
    div.className='char-item';
    if(char.selected) div.classList.add('selected');
    div.draggable=true;

    div.addEventListener('click',(e)=>{
      if(e.target.tagName==='INPUT') return;
      selectedCharacters.forEach(c=>c.selected=false);
      char.selected=!char.selected;
      saveData();
      renderCharList();
      renderBossPanel();
    });

    div.addEventListener('dragstart',e=>{ e.dataTransfer.setData('text/plain',index); });
    div.addEventListener('dragover',e=>e.preventDefault());
    div.addEventListener('drop',e=>{
      e.preventDefault();
      const fromIndex = e.dataTransfer.getData('text/plain');
      const toIndex = index;
      const temp = selectedCharacters[fromIndex];
      selectedCharacters.splice(fromIndex,1);
      selectedCharacters.splice(toIndex,0,temp);
      saveData();
      renderCharList();
    });

    const firstLine = document.createElement('div');
    firstLine.className='char-first-line';

    const nameDiv=document.createElement('div');
    nameDiv.className='char-name';
    nameDiv.innerText=char.name;

    const sum = char.bosses.reduce((a,b)=>a+b.basePrice,0);
    const sumDiv=document.createElement('div');
    sumDiv.className='char-sum';
    sumDiv.innerText = `${sum.toFixed(2)} 억`;

    const del=document.createElement('span');
    del.className='char-delete';
    del.innerText='x';
    del.addEventListener('click',()=>{ 
      selectedCharacters.splice(index,1);
      saveData();
      renderCharList(); renderBossPanel();
    });

    firstLine.appendChild(nameDiv);
    firstLine.appendChild(sumDiv);
    firstLine.appendChild(del);

    const secondLine=document.createElement('div');
    secondLine.className='char-second-line';

    const lvInput=document.createElement('input');
    lvInput.placeholder='Lv';
    lvInput.value=char.level;
    lvInput.addEventListener('input',()=>{char.level=lvInput.value; saveData(); });

    const jobInput=document.createElement('input');
    jobInput.placeholder='직업';
    jobInput.value=char.job;
    jobInput.addEventListener('input',()=>{char.job=jobInput.value; saveData(); });

    secondLine.appendChild(lvInput);
    secondLine.appendChild(jobInput);

    for(let i=0;i<3;i++){
      const noteInput=document.createElement('input');
      noteInput.placeholder=`비고${i+1}`;
      noteInput.value=char.notes[i];
      noteInput.addEventListener('input',()=>{ char.notes[i]=noteInput.value; saveData(); });
      secondLine.appendChild(noteInput);
    }

    div.appendChild(firstLine);
    div.appendChild(secondLine);
    charList.appendChild(div);
  });

  let total = 0;
  selectedCharacters.forEach(char=>{ total += char.bosses.reduce((a,b)=>a+b.basePrice,0); });
  totalSum.innerText = `합계: ${total.toLocaleString()} 억`;
}

function renderBossPanel(){
  const selectedChar = selectedCharacters.find(c=>c.selected);
  if(!selectedChar){
    bossList.innerHTML='캐릭터를 선택해주세요';
    return;
  }
  bossList.innerHTML='';

  const totalSelected = selectedChar.bosses.length;

  bossData.forEach(boss=>{
    const div=document.createElement('div');
    div.className='boss-item';

    const nameDiv=document.createElement('div');
    nameDiv.className='boss-name';
    nameDiv.innerText=boss.name;
    div.appendChild(nameDiv);

    const diffDiv=document.createElement('div');
    diffDiv.className='boss-difficulty';

    const selectedDiff = selectedChar.bosses.find(b=>b.name===boss.name)?.difficulty;

    boss.difficulties.forEach(diff=>{
      const span=document.createElement('span');
      span.innerText=diff;
      span.classList.add(diff);

      const isSelected = selectedDiff === diff;
      if(isSelected) span.classList.add('selected');

      if((selectedDiff && !isSelected) || (totalSelected >= 12 && !isSelected)){
        span.style.opacity = '0.3';
        span.style.pointerEvents = 'none';
      } else {
        span.style.opacity = '1';
        span.style.pointerEvents = 'auto';
      }

      span.addEventListener('click',()=>{
        const alreadySelected = selectedChar.bosses.find(b=>b.name===boss.name && b.difficulty===diff);
        selectedChar.bosses = selectedChar.bosses.filter(b=>b.name!==boss.name);
        if(!alreadySelected){
          if(selectedChar.bosses.length>=12){ alert('총 선택 난이도는 12개까지 가능합니다.'); return; }
          selectedChar.bosses.push({name:boss.name,difficulty:diff,basePrice:boss.basePrice[diff]});
        }
        saveData();
        renderBossPanel();
        renderCharList();
      });

      diffDiv.appendChild(span);
    });

    div.appendChild(diffDiv);
    bossList.appendChild(div);
  });
}

renderCharList();
renderBossPanel();
</script>

</body>
</html>
