<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ìºë¦­í„° ë³´ìŠ¤ ê³„ì‚°ê¸°</title>
<style>
  body { font-family: sans-serif; margin:0; display:flex; height:100vh; }
  .panel { padding:10px; overflow-y:auto; }
  .left { width:25%; border-right:1px solid #ccc; }
  .center { width:50%; border-right:1px solid #ccc; }
  .right { width:25%; }

  /* ìºë¦­í„° ë¦¬ìŠ¤íŠ¸ */
  .char-item { padding:5px; margin-bottom:1px; border:1px solid #aaa; cursor:grab; }
  .char-item.selected { background:#d0f0ff; }

  /* ì²« ë²ˆì§¸ ì¤„ */
  .char-first-line { display:flex; align-items:center; justify-content:space-between; }
  .char-name {
    font-weight: bold;
    width: 103px;  /* ìµœëŒ€ ë„ˆë¹„ë¥¼ 100pxë¡œ ê³ ì • */
    overflow: hidden;   /* ë‚´ìš©ì´ ë„˜ì¹˜ë©´ ìˆ¨ê¹€ */
    text-overflow: ellipsis; /* ë„˜ì¹œ ë¶€ë¶„ì€ 'â€¦'ìœ¼ë¡œ í‘œì‹œ */
    white-space: nowrap; /* í…ìŠ¤íŠ¸ë¥¼ í•œ ì¤„ë¡œ ìœ ì§€ */
}
  .char-sum { min-width:100px; margin-left:20px; text-align:right; flex-shrink:0; }
  .char-delete { cursor:pointer; color:red; margin-left:10px; flex-shrink:0; }

  /* ë‘ ë²ˆì§¸ ì¤„ */
  .char-second-line { display:flex; gap:5px; margin-top:5px; }
  .char-second-line input { width:60px; }

  /* ë³´ìŠ¤ ë¦¬ìŠ¤íŠ¸ */
.boss-item {
  display: grid;
  grid-template-columns: 120px repeat(5, 80px); /* ë³´ìŠ¤ì´ë¦„ + ìµœëŒ€ ë‚œì´ë„ 5ê°œ */
  align-items: center;
  margin-bottom: 5px;
}

.boss-name {
  /* ì²« ë²ˆì§¸ ì»¬ëŸ¼ì— ë“¤ì–´ê°€ëŠ” ë³´ìŠ¤ ì´ë¦„ */
}

.boss-difficulty {
  display: contents; /* spanì´ grid cellì„ ê·¸ëŒ€ë¡œ ì°¨ì§€í•˜ê²Œ í•¨ */
}

.boss-difficulty span {
  display: inline-block; 
  width: 65px;  /* ê° ë‚œì´ë„ ì—´ í­ ê³ ì • */
  text-align: center; /* ì¤‘ì•™ ì •ë ¬ */
}

  /* ë‚œì´ë„ë³„ ìƒ‰ìƒ */
  .boss-difficulty span { cursor:pointer; padding:2px 5px; border-radius:3px; color:white;  font-size:0.85em; /* ê¸€ì ì‘ê²Œ */ }
  .boss-difficulty span.EASY { background:#828282; box-shadow: inset 0 0 0 0.5px #646464;  }
  .boss-difficulty span.NORMAL { background:#37c3c3; box-shadow: inset 0 0 0 0.5px #37b7b7;  }
  .boss-difficulty span.HARD { background:#ff69b4; box-shadow: inset 0 0 0 0.5px #ff32b1; }
  .boss-difficulty span.CHAOS { background:#3c3c3c; color:yellow; box-shadow: inset 0 0 0 0.5px yellow; }
  .boss-difficulty span.EXTREME { background:black; color:red; box-shadow: inset 0 0 0 0.5px red; }

.boss-difficulty span.selected {
  font-weight: bold;
  border: none; /* ê¸°ì¡´ border ì œê±° */
  box-shadow: inset 0 0 0 3px gold; /* ì•ˆìª½ í…Œë‘ë¦¬ */
}
</style>
</head>
<body>

<div class="panel left">
  <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
    <input id="charNameInput" placeholder="ìºë¦­í„° ì´ë¦„ ì…ë ¥" width:150px;" >
    <div id="totalSum" style="font-weight:bold; white-space:nowrap;">í•©ê³„: 0 ì–µ</div>
  </div>
  <div id="charList"></div>
</div>

<div class="panel center">
  <div id="bossList">ìºë¦­í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</div>
</div>

<div class="panel right">
  <textarea id="noteArea" placeholder="" 
    style="width:50%; height:50%; resize:none; font-size:14px; padding:10px; box-sizing:border-box;"></textarea>
</div>

<script>
// âœ… ë¡œê·¸ì¸ ì²´í¬
if (sessionStorage.getItem("auth") !== "true") {
  alert("ì ‘ì† ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
  window.location.href = "index.html";
}

const bossData = [
  { name:"ì‹œê·¸ë„ˆìŠ¤", difficulties:["EASY","NORMAL"], basePrice:{EASY:0.0455,NORMAL:0.075} },
  { name:"íë¼", difficulties:["HARD"], basePrice:{HARD:0.0575} },
  { name:"í•‘í¬ë¹ˆ", difficulties:["CHAOS"], basePrice:{CHAOS:0.0658} },
  { name:"ìì¿°", difficulties:["CHAOS"], basePrice:{CHAOS:0.0808} },
  { name:"ë¸”ëŸ¬ë””í€¸", difficulties:["CHAOS"], basePrice:{CHAOS:0.0814} },
  { name:"ë°˜ë°˜", difficulties:["CHAOS"], basePrice:{CHAOS:0.0815} },
  { name:"í”¼ì—ë¥´", difficulties:["CHAOS"], basePrice:{CHAOS:0.0817} },
  { name:"ë§¤ê·¸ë„ˆìŠ¤", difficulties:["HARD"], basePrice:{HARD:0.0856} },
  { name:"ë²¨ë£¸", difficulties:["CHAOS"], basePrice:{CHAOS:0.0928} },
  { name:"íŒŒí’€ë¼íˆ¬ìŠ¤", difficulties:["CHAOS"], basePrice:{CHAOS:0.138} },
  { name:"ìŠ¤ìš°", difficulties:["NORMAL","HARD","EXTREME"], basePrice:{NORMAL:0.176,HARD:0.542,EXTREME:6.04} },
  { name:"ë°ë¯¸ì•ˆ", difficulties:["NORMAL","HARD"], basePrice:{NORMAL:0.184,HARD:0.515} },
  { name:"ê°€ì—”ìŠ¬", difficulties:["NORMAL","CHAOS"], basePrice:{NORMAL:0.268,CHAOS:0.791} },
  { name:"ë£¨ì‹œë“œ", difficulties:["EASY","NORMAL","HARD"], basePrice:{EASY:0.314,NORMAL:0.375,HARD:0.662} },
  { name:"ìœŒ", difficulties:["EASY","NORMAL","HARD"], basePrice:{EASY:0.34,NORMAL:0.433,HARD:0.812} },
  { name:"ë”ìŠ¤í¬", difficulties:["NORMAL","CHAOS"], basePrice:{NORMAL:0.463,CHAOS:0.735} },
  { name:"ë“„ì¼ˆ", difficulties:["NORMAL","HARD"], basePrice:{NORMAL:0.5,HARD:0.994} },
  { name:"ì§„ íë¼", difficulties:["NORMAL","HARD"], basePrice:{NORMAL:0.749,HARD:1.12} },
  { name:"ì„¸ë Œ", difficulties:["NORMAL","HARD","EXTREME"], basePrice:{NORMAL:2.66,HARD:3.96,EXTREME:31.5} },
  { name:"ì¹¼ë¡œìŠ¤", difficulties:["EASY","NORMAL","CHAOS","EXTREME"], basePrice:{EASY:3.11,NORMAL:5.61,CHAOS:13.4,EXTREME:43.2} },
  { name:"ëŒ€ì ì", difficulties:["EASY","NORMAL","HARD","EXTREME"], basePrice:{EASY:3.24,NORMAL:5.89,HARD:15.1,EXTREME:49.6} },
  { name:"ì¹´ë§", difficulties:["EASY","NORMAL","HARD","EXTREME"], basePrice:{EASY:4.19,NORMAL:7.14,HARD:18.3,EXTREME:56.7} },
  { name:"ë¦¼ë³´", difficulties:["NORMAL","HARD"], basePrice:{NORMAL:10.8,HARD:25.1} },
  { name:"ë°œë“œë¦­ìŠ¤", difficulties:["NORMAL","HARD"], basePrice:{NORMAL:14.4,HARD:32.4} },
];


let selectedCharacters = [];

const charList = document.getElementById('charList');
const bossList = document.getElementById('bossList');
const rightPanel = document.getElementById('rightPanel');
const totalSum = document.getElementById('totalSum');

document.getElementById('charNameInput').addEventListener('keydown',(e)=>{
  if(e.key==='Enter' && e.target.value.trim()!==''){
    const charName = e.target.value.trim();
    const char = { name:charName, level:'', job:'', notes:['','',''], selected:false, bosses:[] };
    selectedCharacters.push(char);
    e.target.value='';
    renderCharList();
  }
});

function renderCharList(){
  charList.innerHTML='';
  selectedCharacters.forEach((char,index)=>{
    const div=document.createElement('div');
    div.className='char-item';
    if(char.selected) div.classList.add('selected');
    div.draggable=true;

    div.addEventListener('click',(e)=>{
      if(e.target.tagName==='INPUT') return;
      selectedCharacters.forEach(c=>c.selected=false);
      char.selected=!char.selected;
      renderCharList();
      renderBossPanel();
    });

    // ë“œë˜ê·¸
    div.addEventListener('dragstart',e=>{ e.dataTransfer.setData('text/plain',index); });
    div.addEventListener('dragover',e=>e.preventDefault());
    div.addEventListener('drop',e=>{
      e.preventDefault();
      const fromIndex = e.dataTransfer.getData('text/plain');
      const toIndex = index;
      const temp = selectedCharacters[fromIndex];
      selectedCharacters.splice(fromIndex,1);
      selectedCharacters.splice(toIndex,0,temp);
      renderCharList();
    });

    // ì²«ë²ˆì§¸ ì¤„: ì´ë¦„ / ê¸ˆì•¡ / ì‚­ì œ
    const firstLine = document.createElement('div');
    firstLine.className='char-first-line';

    const nameDiv=document.createElement('div');
    nameDiv.className='char-name';
    nameDiv.innerText=char.name;

    const sum = char.bosses.reduce((a,b)=>a+b.basePrice,0);
    const sumDiv=document.createElement('div');
    sumDiv.className='char-sum';
    sumDiv.innerText = `${sum.toFixed(2)} ì–µ`;
    const del=document.createElement('span');
    del.className='char-delete';
    del.innerText='x';
    del.addEventListener('click',()=>{ 
      selectedCharacters.splice(index,1);
      renderCharList(); renderBossPanel(); renderRightPanel();
    });

    firstLine.appendChild(nameDiv);
    firstLine.appendChild(sumDiv);
    firstLine.appendChild(del);

    // ë‘ë²ˆì§¸ ì¤„: Lv / ì§ì—… / ë¹„ê³ 1~3
    const secondLine=document.createElement('div');
    secondLine.className='char-second-line';

    const lvInput=document.createElement('input');
    lvInput.placeholder='Lv';
    lvInput.value=char.level;
    lvInput.addEventListener('input',()=>{char.level=lvInput.value;});

    const jobInput=document.createElement('input');
    jobInput.placeholder='ì§ì—…';
    jobInput.value=char.job;
    jobInput.addEventListener('input',()=>{char.job=jobInput.value;});

    secondLine.appendChild(lvInput);
    secondLine.appendChild(jobInput);

    for(let i=0;i<3;i++){
      const noteInput=document.createElement('input');
      noteInput.placeholder=`ë¹„ê³ ${i+1}`;
      noteInput.value=char.notes[i];
      noteInput.addEventListener('input',()=>{ char.notes[i]=noteInput.value; });
      secondLine.appendChild(noteInput);
    }

    div.appendChild(firstLine);
    div.appendChild(secondLine);
    charList.appendChild(div);
  });
  // ğŸ”¹ ì´í•© í‘œì‹œ (ì™¼ìª½ íŒ¨ë„ í•˜ë‹¨)
  let total = 0;
  selectedCharacters.forEach(char=>{
    total += char.bosses.reduce((a,b)=>a+b.basePrice,0);
  });
  totalSum.innerText = `í•©ê³„: ${total.toLocaleString()} ì–µ`;
}


function renderBossPanel(){
  const selectedChar = selectedCharacters.find(c=>c.selected);
  if(!selectedChar){
    bossList.innerHTML='ìºë¦­í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”';
    return;
  }
  bossList.innerHTML='';

  const totalSelected = selectedChar.bosses.length;

  bossData.forEach(boss=>{
    const div=document.createElement('div');
    div.className='boss-item';

    const nameDiv=document.createElement('div');
    nameDiv.className='boss-name';
    nameDiv.innerText=boss.name;
    div.appendChild(nameDiv);

    const diffDiv=document.createElement('div');
    diffDiv.className='boss-difficulty';

    const selectedDiff = selectedChar.bosses.find(b=>b.name===boss.name)?.difficulty;

    boss.difficulties.forEach(diff=>{
      const span=document.createElement('span');
      span.innerText=diff;
      span.classList.add(diff);

      // ì„ íƒ ì—¬ë¶€
      const isSelected = selectedDiff === diff;
      if(isSelected) span.classList.add('selected');

      // íšŒìƒ‰ ì²˜ë¦¬ ì¡°ê±´
      if((selectedDiff && !isSelected) || (totalSelected >= 12 && !isSelected)){
        span.style.opacity = '0.3'; // íšŒìƒ‰ì²˜ëŸ¼ ë³´ì´ê²Œ
        span.style.pointerEvents = 'none'; // í´ë¦­ ë§‰ê¸°
      } else {
        span.style.opacity = '1';
        span.style.pointerEvents = 'auto';
      }

      span.addEventListener('click',()=>{
        const alreadySelected = selectedChar.bosses.find(b=>b.name===boss.name && b.difficulty===diff);
        selectedChar.bosses = selectedChar.bosses.filter(b=>b.name!==boss.name);
        if(!alreadySelected){
          if(selectedChar.bosses.length>=12){
            alert('ì´ ì„ íƒ ë‚œì´ë„ëŠ” 12ê°œê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            return;
          }
          selectedChar.bosses.push({name:boss.name,difficulty:diff,basePrice:boss.basePrice[diff]});
        }
        renderBossPanel();
        renderCharList();
        renderRightPanel();
      });

      diffDiv.appendChild(span);
    });

    div.appendChild(diffDiv);
    bossList.appendChild(div);
  });
}

function renderRightPanel(){
 
}

renderCharList();
renderBossPanel();
renderRightPanel();
</script>

</body>
</html>
